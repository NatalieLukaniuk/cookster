<h1>Recipy constructor</h1>
<mat-stepper #stepper (selectionChange)="stepSelected($event)" linear>
    <mat-step [completed]="name.valid" #generalInfo editable="false">
        <ng-template matStepLabel><span
                [class.has-errors]="name.invalid && (name.dirty || name.touched)">інформація</span>
        </ng-template>

        <div class="additional-info-wrapper">
            <mat-form-field appearance="outline" class="recipy-name">
                <mat-label>Назва рецепту</mat-label>
                <input matInput required minlength="4" type="text" [(ngModel)]="newRecipy.name"
                    placeholder="Напр.: Картопляне пюре" #name="ngModel" />
                <mat-icon matSuffix svgIcon="done" *ngIf="name.valid && (name.dirty || name.touched)"></mat-icon>
            </mat-form-field>


            <mat-checkbox [(ngModel)]="isSplitToGroups" (ngModelChange)="toggleSplitToGroups()">
                Рецепт складається з кількох груп (тісто, начинка, оздоблення, тощо)
            </mat-checkbox>
        </div>
        <div>
            <button mat-flat-button class="action-button" [disabled]="!generalInfo.completed" matStepperNext>
                Далі
            </button>
        </div>
    </mat-step>
    <mat-step [completed]="newRecipy.ingrediends.length > 0" #ingredients>
        <ng-template matStepLabel><span
                [class.has-errors]="!newRecipy.ingrediends.length && ingredients.interacted">Інгридієнти</span>
        </ng-template>
        <ng-container *ngIf="newRecipy.ingrediends.length > 0">
            <ng-container *ngIf="newRecipy.isSplitIntoGroups.length <= 0">
                <app-ingredient *ngFor="let ingredient of newRecipy.ingrediends" [ingredient]="ingredient"
                    [isMobile]="isMobile">
                </app-ingredient>
            </ng-container>
            <ng-container *ngIf="newRecipy.isSplitIntoGroups.length > 0">
                <ng-container *ngFor="let item of ingredientsByGroup | keyvalue">
                    <ng-container *ngIf="item.value.length > 0">
                        <h4>{{item.key}}</h4>
                        <app-ingredient *ngFor="let ingredient of item.value" [ingredient]="ingredient"
                            [isMobile]="isMobile"></app-ingredient>
                    </ng-container>
                </ng-container>
            </ng-container>
        </ng-container>

        <app-add-ingredient [isIngredientsSplitToGroups]='!!newRecipy.isSplitIntoGroups.length'
            (addNewIngredient)="onaAddNewIngredient($event)"></app-add-ingredient>
        <div>
            <button mat-flat-button class="action-button" [disabled]="newRecipy.ingrediends.length <= 0" matStepperNext>
                Далі
            </button>
        </div>
    </mat-step>
    <mat-step [completed]="newRecipy.steps.length > 0" #steps>
        <ng-template matStepLabel><span
                [class.has-errors]="!newRecipy.steps.length && steps.interacted">Приготування</span>
        </ng-template>
        <ng-container *ngIf="newRecipy.steps.length > 0">
            <table class="steps-table" *ngIf="!newRecipy.isSplitIntoGroups.length">
                <tr *ngFor="let step of newRecipy.steps; let i = index">
                    <td>
                        <p>{{ i + 1 }}. {{ step.description }}</p>
                    </td>
                    <td>{{ getTotalStepTime(step) }} хв.</td>
                </tr>
            </table>
            <ng-container *ngIf="newRecipy.isSplitIntoGroups.length > 0">
                <ng-container *ngFor="let item of stepsByGroup | keyvalue">
                    <ng-container *ngIf="item.value.length > 0">
                        <h4>{{item.key}}</h4>
                        <table class="steps-table">
                            <tr *ngFor="let step of item.value; let i = index">
                                <td>
                                    <p>{{ step.id }}. {{ step.description }}</p>
                                </td>
                                <td>{{ getTotalStepTime(step) }} хв.</td>
                            </tr>
                        </table>
                    </ng-container>
                </ng-container>
            </ng-container>
        </ng-container>
        <app-add-step [index]="1" [isSplitToGroups]='!!newRecipy.isSplitIntoGroups.length'
            [groupOptions]="newRecipy.isSplitIntoGroups" (addNewStep)="onAddNewStep($event)"></app-add-step>
        <div>
            <button mat-flat-button class="action-button" [disabled]="newRecipy.steps.length <= 0" matStepperNext>
                Далі
            </button>
        </div>
    </mat-step>
    <mat-step [completed]="newRecipy.steps.length > 0" #additional>
        <ng-template matStepLabel><span
                [class.has-errors]="!newRecipy.steps.length && steps.interacted">Приготування</span>
        </ng-template>
        <label id="example-radio-group-label">Виберіть складність</label>
        <mat-radio-group aria-labelledby="example-radio-group-label" class="example-radio-group"
            [(ngModel)]="newRecipy.complexity">
            <mat-radio-button class="example-radio-button" *ngFor="let unit of complexityOptions" [value]="unit">
                {{getComplexityOptionsText(unit)}}
            </mat-radio-button>
        </mat-radio-group>
        <h4>Виберіть теги</h4>
        <app-add-tags [tags]="tags" (selectedTags)="onTagsSelectionChange($event)"></app-add-tags>

        <button mat-flat-button class="action-button" (click)="onPreviewRecipy()">
            Переглянути
        </button>
    </mat-step>

</mat-stepper>